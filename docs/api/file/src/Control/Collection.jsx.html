<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/Control/Collection.jsx | incarnate-dom</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Integrate Incarnate with React and React Router DOM."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="incarnate-dom"><meta property="twitter:description" content="Integrate Incarnate with React and React Router DOM."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/resistdesign/incarnate-dom"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Incarnate.jsx~Incarnate.html">Incarnate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/LifePod.jsx~LifePod.html">LifePod</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Provider">Provider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Collection">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Incarnate">Incarnate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IncarnateRedirect">IncarnateRedirect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IncarnateRoute">IncarnateRoute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IncarnateRouter">IncarnateRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IncarnateSwitch">IncarnateSwitch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LifePod">LifePod</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Memoize">Memoize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Traverse">Traverse</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#control">Control</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Control/Collection.jsx~Collection.html">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Control/ExplicitlyCachedValue.jsx~ExplicitlyCachedValue.html">ExplicitlyCachedValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Control/Memoize.jsx~Memoize.html">Memoize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Control/Traverse.jsx~Traverse.html">Traverse</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#future">Future</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Future/ItemState.jsx~ItemState.html">ItemState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Future/ItemStateController.jsx~ItemStateController.html">ItemStateController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateList">updateList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_PRIMARY_KEY">DEFAULT_PRIMARY_KEY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OPERATIONS">OPERATIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SETS">SETS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STATES">STATES</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#routing">Routing</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Routing/IncarnateRedirect.jsx~IncarnateRedirect.html">IncarnateRedirect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Routing/IncarnateRoute.jsx~IncarnateRoute.html">IncarnateRoute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Routing/IncarnateRouter.jsx~IncarnateRouter.html">IncarnateRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Routing/IncarnateSwitch.jsx~IncarnateSwitch.html">IncarnateSwitch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getParamsObjectFromRouteProps">getParamsObjectFromRouteProps</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getQueryObjectFromRouteProps">getQueryObjectFromRouteProps</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getUrl">getUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PATH_NAMES">PATH_NAMES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Provider">Provider</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">Utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultMapKeyDelimiter">getDefaultMapKeyDelimiter</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Control/Collection.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import T from &apos;prop-types&apos;;
import React, {PureComponent} from &apos;react&apos;;
import {LifePod} from &apos;../index&apos;;

function getCleanIndex(index = 0) {
  const parsedIndex = parseInt(`${index}`, 10);
  const repairedIndex = `${parsedIndex}` === &apos;NaN&apos; ? 0 : parsedIndex;

  return repairedIndex &lt; 0 ? 0 : repairedIndex;
}

export default class Collection extends PureComponent {
  static propTypes = {
    name: T.string,
    dependencyPath: T.oneOfType([
      T.string,
      T.arrayOf(
        T.string
      )
    ]),
    primaryKey: T.string
  };
  defaultProps = {
    primaryKey: &apos;id&apos;
  };

  controller;

  getController() {
    if (!this.controller) {
      this.controller = {
        addItems: this.addItems,
        addItem: this.addItem,
        addItemsAtIndex: this.addItemsAtIndex,
        addItemAtIndex: this.addItemAtIndex,
        removeItem: this.removeItem,
        removeItemAtIndex: this.removeItemAtIndex,
        removeItemByPrimaryKeyValue: this.removeItemByPrimaryKeyValue,
        getIndicesForItem: this.getIndicesForItem,
        getItemAtIndex: this.getItemAtIndex,
        getItemByPrimaryKeyValue: this.getItemByPrimaryKeyValue,
        getMapByPrimaryKey: this.getMapByPrimaryKey,
        setFromMap: this.setFromMap,
        addFromMap: this.addFromMap,
        moveItemByIndex: this.moveItemByIndex,
        switchItemsByIndices: this.switchItemsByIndices,
        switchItems: this.switchItems,
        updateItemByPrimaryKeyValue: this.updateItemByPrimaryKeyValue,
        updateItem: this.updateItem,
        updateItemsByMap: this.updateItemsByMap,
        clear: this.clear
      };
    }

    return this.controller;
  }

  getDepValue;
  setDepValue;

  getCurrentDepValue() {
    let value;

    if (this.getDepValue instanceof Function) {
      value = this.getDepValue();

      if (!(value instanceof Array)) {
        value = [];
      }
    }

    return value;
  }

  setNewDepValue(value = []) {
    if (this.setDepValue instanceof Function) {
      this.setDepValue(value);
    }
  }

  addItems = (items = []) =&gt; {
    const value = this.getCurrentDepValue();

    this.setNewDepValue([
      ...value,
      ...items
    ]);
  };

  addItem = (item) =&gt; {
    this.addItems([item]);
  };

  addItemsAtIndex = (items = [], index = 0) =&gt; {
    const value = this.getCurrentDepValue();
    const cleanIndex = getCleanIndex(index);

    if (cleanIndex &gt;= value.length) {
      this.addItems(items);
    } else {
      const before = value.slice(0, cleanIndex);
      const after = value.slice(cleanIndex, value.length);

      this.setNewDepValue([
        ...before,
        ...items,
        ...after
      ]);
    }
  };

  addItemAtIndex = (item, index = 0) =&gt; {
    this.addItemsAtIndex([item], index);
  };

  removeItem = (item) =&gt; {
    const value = this.getCurrentDepValue();

    this.setNewDepValue(
      value.filter(v =&gt; v !== item)
    );
  };

  removeItemAtIndex = (index = 0) =&gt; {
    const value = this.getCurrentDepValue();
    const cleanIndex = getCleanIndex(index);

    this.setNewDepValue(
      value.filter((v, i) =&gt; i !== cleanIndex)
    );
  };

  removeItemByPrimaryKeyValue = (primaryKeyValue) =&gt; {
    const {primaryKey} = this.props;
    const value = this.getCurrentDepValue();

    this.setNewDepValue(
      value.filter(({[primaryKey]: pkv} = {}) =&gt; pkv !== primaryKeyValue)
    );
  };

  getIndicesForItem = (item) =&gt; {
    const value = this.getCurrentDepValue();

    return value.reduce((acc, v, i) =&gt; {
      if (v === item) {
        acc.push(i);
      }

      return acc;
    }, []);
  };

  getItemAtIndex = (index = 0) =&gt; {
    const value = this.getCurrentDepValue();
    const cleanIndex = getCleanIndex(index);

    return value[cleanIndex];
  };

  getItemByPrimaryKeyValue = (primaryKeyValue) =&gt; {
    const {primaryKey} = this.props;
    const value = this.getCurrentDepValue();

    return value.filter(({[primaryKey]: v} = {}) =&gt; v === primaryKeyValue)[0];
  };

  getMapByPrimaryKey = () =&gt; {
    const {primaryKey} = this.props;
    const value = this.getCurrentDepValue();

    return value.reduce((acc, item = {}) =&gt; {
      const {[primaryKey]: primaryKeyValue} = item;

      acc[primaryKeyValue] = item;

      return acc;
    }, {});
  };

  setFromMap = (map = {}) =&gt; {
    this.setNewDepValue(
      Object
        .keys(map)
        .map(k =&gt; map[k])
    );
  };

  addFromMap = (map = {}) =&gt; {
    const valueMap = this.getMapByPrimaryKey();
    const fullMap = {
      ...valueMap,
      ...map
    };

    this.setNewDepValue(
      Object
        .keys(fullMap)
        .map(k =&gt; fullMap[k])
    );
  };

  moveItemByIndex = (fromIndex = 0, toIndex = 0) =&gt; {
    const cleanFromIndex = getCleanIndex(fromIndex);
    const cleanToIndex = getCleanIndex(toIndex);

    if (cleanFromIndex !== cleanToIndex) {
      const item = this.getItemAtIndex(cleanFromIndex);
      const value = this.getCurrentDepValue();

      let newDepValue;

      if (cleanToIndex &gt;= value.length) {
        newDepValue = [
          ...value,
          item
        ];
      } else {
        newDepValue = value.reduce((acc, v, i) =&gt; {
          if (i === cleanToIndex) {
            acc.push(item);
          }

          if (i !== cleanFromIndex) {
            acc.push(v);
          }

          return acc;
        }, []);
      }

      this.setNewDepValue(
        newDepValue
      );
    }
  };

  switchItemsByIndices = (indexA = 0, indexB = 0) =&gt; {
    const value = this.getCurrentDepValue();
    const cleanIndexA = getCleanIndex(indexA);
    const cleanIndexB = getCleanIndex(indexB);

    if (cleanIndexA !== cleanIndexB) {
      const itemA = this.getItemAtIndex(cleanIndexA);
      const itemB = this.getItemAtIndex(cleanIndexB);

      this.setNewDepValue(
        value.reduce((acc, v, i) =&gt; {
          if (i === cleanIndexA) {
            acc.push(itemB);
          } else if (i === cleanIndexB) {
            acc.push(itemA);
          } else {
            acc.push(v);
          }

          return acc;
        }, [])
      );
    }
  };

  switchItems = (itemA, itemB) =&gt; {
    const indexA = this.getIndicesForItem(itemA)[0];
    const indexB = this.getIndicesForItem(itemB)[0];

    if (typeof indexA !== &apos;undefined&apos; &amp;&amp; typeof indexB !== &apos;undefined&apos;) {
      this.switchItemsByIndices(indexA, indexB);
    }
  };

  updateItemByPrimaryKeyValue = (primaryKeyValue, item) =&gt; {
    const {primaryKey} = this.props;
    const value = this.getCurrentDepValue();

    this.setNewDepValue(
      value.map((v = {}) =&gt; {
        const {[primaryKey]: pkv} = v;

        return pkv === primaryKeyValue ? item : v;
      })
    );
  };

  updateItem = (item) =&gt; {
    if (item instanceof Object) {
      const {primaryKey} = this.props;
      const {[primaryKey]: primaryKeyValue} = item;

      this.updateItemByPrimaryKeyValue(primaryKeyValue, item);
    }
  };

  updateItemsByMap = (map = {}) =&gt; {
    const {primaryKey} = this.props;
    const value = this.getCurrentDepValue();

    this.setNewDepValue(
      value.map((v = {}) =&gt; {
        const {[primaryKey]: pkv} = v;

        return map.hasOwnProperty(pkv) ? map[pkv] : v;
      })
    );
  };

  clear = () =&gt; {
    this.setNewDepValue([]);
  };

  render() {
    const {
      name,
      dependencyPath
    } = this.props;

    return (
      &lt;LifePod
        name={name}
        getters={{
          depValue: dependencyPath
        }}
        setters={{
          depValue: dependencyPath
        }}
        factory={({getDepValue, setDepValue} = {}) =&gt; {
          this.getDepValue = getDepValue;
          this.setDepValue = setDepValue;

          return this.getController();
        }}
      /&gt;
    );
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
